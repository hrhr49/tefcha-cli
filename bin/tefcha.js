(function () {var Z={};var aa={};var I={},ya=I&&I.__extends||function(){var e=function(r,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])})(r,n)};return function(r,n){function t(){this.constructor=r}e(r,n),r.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}}(),ia=I&&I.__assign||function(){return(ia=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},U=I&&I.__spreadArrays||function(){for(var e=0,r=0,n=arguments.length;r<n;r++)e+=arguments[r].length;var t=Array(e),o=0;for(r=0;r<n;r++)for(var s=arguments[r],a=0,i=s.length;a<i;a++,o++)t[o]=s[a];return t},q=function(e){function r(r){var n=r.lineno,t=r.msg,o=r.src,s=void 0===o?"":o,a=this,i=t;n&&n>0&&(i="at line "+n+": "+i);var $="";return s&&void 0!==n&&n>0&&($=s.split(/\n/).map(function(e,r){return{lineno:r+1,line:e}}).slice(Math.max(0,n-1-5),n-1+5).map(function(e){var r=e.lineno,t=e.line;return(r===n?">":" ")+r+": "+t}).join("\n")),(a=e.call(this,i+"\n"+$)||this).lineno=null!=n?n:null,a.msg=t,a.src=s,a.type="tefcha",a}return ya(r,e),r}(Error),ja=["if","else","elif","while","for","do","switch","case","try","except"],ka=U(ja,["continue","break","pass"]),a=U(ka,["program","none","text"]),za=function(e){return ja.includes(e)},Aa=function(e){return ka.includes(e)},Ba=function(e,r){var n=[],t="",o=r.src,s=o.indentStr,a=o.commentStr;if(e.split(/\r\n|\r|\n/).forEach(function(e,r){if(r++,""!==(e=t+e).trim()){for(var o=0;e.startsWith(s);)o++,e=e.slice(s.length);e.startsWith(a)||(e.endsWith("\\")?t=e.slice(0,-1):(t="",n.push({lineno:r,line:e,nest:o})))}}),""!==t)throw new q({msg:"EOF is found after '\\'"});var i=Math.min.apply(Math,n.map(function(e){return e.nest}));return n=n.map(function(e){return ia(ia({},e),{nest:e.nest-i})})},Ca=function(e,r){var n={type:"program",lineno:0,content:"",children:[]},t=[n];return e.forEach(function(e){var n=e.lineno,o=e.line,s=e.nest;if(t.length-1<s)throw new q({lineno:n,src:r,msg:"unexpected indent"});for(;t.length-1>s;)t.pop();var a=t.slice(-1)[0],i=o.split(" ")[0];if(Aa(i)){var $={type:i,lineno:n,content:o.slice(o.indexOf(" ")+1),children:[]},c=a.children.length>0?a.children.slice(-1)[0]:null;a.children.push($),za(i)&&(c&&"do"===c.type&&"while"===i||t.push($))}else a.children.push({type:"text",lineno:n,content:o,children:[]})}),n},la=function(e,r,n){var t=e.children||[],o={type:"none",lineno:-1,content:"",children:[]};t.forEach(function(s,a){var i=s.lineno;switch(s.type){case"program":break;case"none":throw new q({lineno:i,src:n,msg:"node type \""+s.type+"\" must not be here... this may be bug"});case"text":case"if":break;case"else":if(!["if","elif"].includes(o.type))throw new q({lineno:i,src:n,msg:"before \"else\" statement, \"if\" or \"elif\" should exists."});break;case"elif":if(!["if","elif"].includes(o.type))throw new q({lineno:i,src:n,msg:"before \"elif\" statement, \"if\" or \"elif\" should exists."});break;case"while":break;case"for":throw new q({lineno:i,src:n,msg:"node type \""+s.type+"\" is not implemented yet."});case"switch":if(0===s.children.length)throw new q({lineno:i,src:n,msg:"switch blcok needs at least 1 case blocks"});break;case"case":if("switch"!==e.type)throw new q({lineno:i,src:n,msg:"keyword \"case\" should be in \"switch\" statement."});break;case"continue":if(!U(r,[e]).some(function(e){return["for","while","do"].includes(e.type)}))throw new q({lineno:i,src:n,msg:"\"continue\" statement should be in loop"});break;case"break":if(!U(r,[e]).some(function(e){return["for","while","do"].includes(e.type)}))throw new q({lineno:i,src:n,msg:"\"break\" statement should be in loop or \"case\"."});break;case"do":if(a+1>=t.length||"while"!==t[a+1].type)throw new q({lineno:i,src:n,msg:"cannot find corresponding keyword \"while\" to keyword \"do\"."});break;case"pass":break;case"try":if(a+1>=t.length||"except"!==t[a+1].type)throw new q({lineno:i,src:n,msg:"cannot find corresponding keyword \"except\" to keyword \"try\"."});break;case"except":if(!["try","except"].includes(o.type))throw new q({lineno:i,src:n,msg:"before \"except\" block, \"try\" or \"except\" block should exists."});break;default:var $=s.type;throw new q({lineno:i,src:n,msg:"node type \""+$+"\" is invalid."});}o=s}),"switch"===e.type&&t.forEach(function(e){var r=e.lineno;if("case"!==e.type)throw new q({lineno:r,src:n,msg:e.type+"\" is found in \"switch\" block. \"switch\" should have \"case\" only"})}),t.forEach(function(t){return la(t,U(r,[e]),n)})},ma=function(e,r){var n=Ba(e,r),t=Ca(n,e);return la(t,[],e),t};I.TefchaError=q,I.parse=ma;var O={};var B={},L=B&&B.__extends||function(){var t=function(r,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])})(r,n)};return function(r,n){function $(){this.constructor=r}t(r,n),r.prototype=null===n?Object.create(n):($.prototype=n.prototype,new $)}}(),Da=B&&B.__spreadArrays||function(){for(var t=0,r=0,n=arguments.length;r<n;r++)t+=arguments[r].length;var $=Array(t),e=0;for(r=0;r<n;r++)for(var s=arguments[r],a=0,o=s.length;a<o;a++,e++)$[e]=s[a];return $},P=Math.max,Q=Math.min,J=function(){return function(t){var r=this,n=t.x,$=void 0===n?0:n,e=t.y,s=void 0===e?0:e,a=t.w,o=void 0===a?0:a,i=t.h,u=void 0===i?0:i,x=t.minX,p=void 0===x?0:x,m=t.minY,h=void 0===m?0:m,v=t.maxX,c=void 0===v?0:v,C=t.maxY,d=void 0===C?0:C;this.trans=function(t,n){return r.x+=t,r.y+=n,r},this.x=$,this.y=s,this.w=o,this.h=u,this.minX=p,this.minY=h,this.maxX=c,this.maxY=d}}(),R=function(t){function r(n){var $=n.x,e=n.y,s=t.call(this,{x:$,y:e})||this;return s.clone=function(){return new r({x:s.x,y:s.y})},s.type="point",s}return L(r,t),r}(J),z=function(t){function r(r){var n=r.x,$=r.y,e=r.cmds,s=r.isArrow,a=void 0!==s&&s,o=this,i=0,u=0,x=0,p=0,m=0,h=0;return e.forEach(function(t){var r=t[0],n=t[1];"h"===r?i+=n:u+=n,x=Q(x,i),p=Q(p,u),m=P(m,i),h=P(h,u)}),(o=t.call(this,{x:n,y:$,minX:x,minY:p,maxX:m,maxY:h,w:m-x,h:h-p})||this).cmds=e,o.isArrow=a,o.type="path",o}return L(r,t),r.vline=function(t){var n=t.x,$=t.y,e=t.step,s=t.isArrow;return new r({x:n,y:$,cmds:[["v",e]],isArrow:void 0!==s&&s})},r.hline=function(t){var n=t.x,$=t.y,e=t.step,s=t.isArrow;return new r({x:n,y:$,cmds:[["h",e]],isArrow:void 0!==s&&s})},r}(J),ba=function(t){function r(r){var n=r.content,$=r.w,e=r.h,s=r.x,a=void 0===s?0:s,o=r.y,i=void 0===o?0:o,u=r.isLabel,x=void 0!==u&&u,p=t.call(this,{x:a,y:i,maxX:$,maxY:e,w:$,h:e})||this;return p.content=n,p.type="text",p.isLabel=x,p}return L(r,t),r.byMeas=function(t){var n=t.x,$=void 0===n?0:n,e=t.y,s=void 0===e?0:e,a=t.text,o=t.attrs,i=t.meas,u=t.isLabel,x=i(a,o);return new r({content:a,x:$,y:s,w:x.w,h:x.h,isLabel:u})},r}(J),na=function(t){function r(r){var n=r.x,$=void 0===n?0:n,e=r.y,s=void 0===e?0:e,a=r.w,o=r.h,i=t.call(this,{x:$,y:s,w:a,h:o,maxX:a,maxY:o})||this;return i.type="rect",i}return L(r,t),r}(J),oa=function(t){function r(r){var n=r.x,$=void 0===n?0:n,e=r.y,s=void 0===e?0:e,a=r.w,o=r.h,i=t.call(this,{x:$,y:s,w:a,h:o,maxX:a,maxY:o})||this;return i.type="frame",i}return L(r,t),r}(J),pa=function(t){function r(r){var n=r.x,$=void 0===n?0:n,e=r.y,s=void 0===e?0:e,a=r.w,o=r.h,i=t.call(this,{x:$,y:s,w:a,h:o,maxX:a,maxY:o})||this;return i.type="diamond",i}return L(r,t),r}(J),ca=function(t){function r(r){var n=r.x,$=r.y,e=r.children,s=t.call(this,{x:n,y:$})||this;return s.add=function(t){return s.minX=Q(s.minX,t.x+t.minX),s.minY=Q(s.minY,t.y+t.minY),s.maxX=P(s.maxX,t.x+t.maxX),s.maxY=P(s.maxY,t.y+t.maxY),s.w=s.maxX-s.minX,s.h=s.maxY-s.minY,s.children.push(t),s},0===e.length&&(e=Da(e,[new R({x:n,y:$})])),s.minX=Q.apply(void 0,e.map(function(t){return t.x+t.minX})),s.minY=Q.apply(void 0,e.map(function(t){return t.y+t.minY})),s.maxX=P.apply(void 0,e.map(function(t){return t.x+t.maxX})),s.maxY=P.apply(void 0,e.map(function(t){return t.y+t.maxY})),s.w=s.maxX-s.minX,s.h=s.maxY-s.minY,s.type="group",s.children=e,s}return L(r,t),r}(J);B.BaseShape=J,B.Group=ca,B.Diamond=pa,B.Frame=oa,B.Rect=na,B.Text=ba,B.Path=z,B.Point=R;var V=function(t){return"number"==typeof(null==t?void 0:t.start)&&"number"==typeof(null==t?void 0:t.end)&&null===(null==t?void 0:t.next)},da=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n={start:1/0,end:1/0,next:null};return t.slice().reverse().forEach(function(t){var e=t[0],r=t[1];n={start:e,end:r,next:n}}),{start:-1/0,end:-1/0,next:n}},ea=function(){return function t(e){var n=this;this.clone=function(){return new t(n.head)},this.cloneDeep=function(){return new t(da.apply(void 0,n.ranges().map(function(t){return[t.start,t.end]})))},this.findSpace=function(t,e){for(var r=n.head;!V(r.next)&&r.next.start<t;)r=r.next;for(var a=Math.max(t,r.end);!V(r.next)&&r.next.start-a<e;)a=(r=r.next).end;return a},this.merge=function(t,e){for(var r,a=t+e,i=n.head;!V(i.next)&&i.next.start<=t;)i=i.next;for(t<=i.end?r=i:(r={start:t,end:t,next:i.next},i.next=r,i=r);!V(i.next)&&i.next.start<=a;)i=i.next;a<=i.end?(r.end=i.end,r.next=i.next):(r.end=a,r.next=i.next)},this.ranges=function(){var t=[],e=n.head;for(e.start===-1/0&&(e=e.next);!V(e);)t.push({start:e.start,end:e.end}),e=e.next;return t},this.mergeAllocator=function(t){t.ranges().forEach(function(t){var e=t.start,r=t.end;n.merge(e,r-e)})},this.head=e}}();var qa=O&&O.__assign||function(){return(qa=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},N=O&&O.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var a=Array(e),n=0;for(t=0;t<r;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,n++)a[n]=i[o];return a},Ea=!1,fa={while:{break:"E",continue:"W"},doWhile:{break:"E",continue:"E"},for:{break:"E",continue:"W"}},ga=function(){return function(e){void 0===e&&(e="none"),this.type=e,this.breaks=[],this.continues=[]}}(),ra=function(){return function e(t){var r=this,a=t.shapes,n=t.measureText,i=t.config,o=t.loop,s=t.AllocW,c=t.AllocE,h=t.x,l=t.y,p=t.yesTextSize,$=t.noTextSize;this.shiftX=function(e){var t=r,a=t.shapes,n=t.loop;a.trans(e,0),r.x+=e;var i=n.breaks,o=n.continues;i.forEach(function(t){return t.trans(e,0)}),o.forEach(function(t){return t.trans(e,0)})},this.step=function(e,t){void 0===e&&(e=r.dy),void 0===t&&(t=!1),r.shapes.add(z.vline({x:0,y:r.y,step:e,isArrow:t})),r.move(e)},this.stepAbs=function(e,t){void 0===t&&(t=!1),r.step(e-r.y,t)},this.move=function(e){void 0===e&&(e=r.dy),r.y+=e},this.moveAbs=function(e){r.move(e-r.y)},this.rect=function(e){var t=e.x,a=e.y,n=e.text,i=r.measureText(n,r.config.text.attrs),o=i.w,s=i.h,c=r.config.rect,h=o+2*c.padX,l=s+2*c.padY;return r.wrapText({cls:na,text:n,x:t,y:a,w:h,h:l,tw:o,th:s})},this.diamond=function(e){var t=e.x,a=e.y,n=e.text,i=r.measureText(n,r.config.text.attrs),o=i.w,s=i.h,c=r.config.diamond.aspectRatio,h=o+s/c,l=s+o*c;return r.wrapText({cls:pa,text:n,x:t,y:a,w:h,h:l,tw:o,th:s})},this.wrapText=function(e){var t=e.cls,a=e.text,n=e.x,i=e.y,o=e.w,s=e.h,c=e.tw,h=e.th,l=r.text({text:a,x:-c/2,y:s/2-h/2,w:c,h:h,isLabel:!1}),p=new t({x:-o/2,w:o,h:s});return new ca({x:n,y:i,children:[l,p]})},this.text=function(e){var t=e.x,r=e.y,a=e.w,n=e.h,i=e.text,o=e.isLabel;return new ba({content:i,x:t,y:r,w:a,h:n,isLabel:o})},this.textWithAutoSize=function(e){var t=e.x,a=e.y,n=e.text,i=e.isLabel;return ba.byMeas({x:t,y:a,text:n,attrs:r.config.text.attrs,meas:r.measureText,isLabel:i})},this.stepText=function(e){var t=r,a=t.dy,n=t.hlineMargin,i=r.rect({x:0,y:0,text:e}),o=r.AllocE.findSpace(r.y+a-n,i.h+n);r.AllocW.merge(o,i.h+n),r.stepAbs(o+n,!0),i.trans(0,r.y),r.shapes.add(i),r.move(i.h)},this.stepCond=function(e){var t,a=e.content,n=e.yesDir,i=e.noDir,o=e.jumpW,s=e.jumpE,c=e.stepY,h=void 0===c?r.dy:c,l=r,p=l.AllocW,$=l.AllocE,u=l.shapes,w=l.diamond,f=l.text,x=l.stepAbs,y=l.move,v=l.hlineMargin,m=l.yesTextSize,d=l.noTextSize,T=r.config.label,D=T.yesText,g=T.noText,A=r.config.label,b=A.marginX,E=A.marginY,S=w({x:0,y:0,text:a});if(o)for(var W=r.y+h-v;;){var X=$.findSpace(W,S.h+v),j=p.findSpace(X+S.h/2,v);if(j===X+S.h/2){t=X;break}W=j-S.h/2}else t=$.findSpace(r.y+h-v,S.h+v);p.merge(t,S.h+v),s&&$.merge(t+S.h/2,v),x(t+v,!0),S.trans(0,r.y),u.add(S),y(S.h);var F={E:{x:S.w/2,y:S.y+S.h/2},W:{x:-S.w/2,y:S.y+S.h/2},S:{x:0,y:S.y+S.h}},_="W"!==n?F[n].x+b:F[n].x-b-m.w;u.add(f({x:_,y:F[n].y+E,w:m.w,h:m.h,text:D,isLabel:!0}));var M="W"!==i?F[i].x+b:F[i].x-b-d.w;return u.add(f({x:M,y:F[i].y+E,w:d.w,h:d.h,text:g,isLabel:!0})),F},this.branch=function(){if(Ea){var t="",a=r.AllocW.ranges()[0],n=Math.round(r.y);a?r.AllocW.ranges().forEach(function(e){var r=Math.round(e.start),a=Math.round(e.end);t+="\n",t+="s:"+r+", e:"+a}):t="first is undef",r.h(r.y,"b:"+n+", "+t)}return new e({shapes:new ca({x:r.x,y:r.y,children:[]}),measureText:r.measureText,config:r.config,loop:new ga(r.loop.type),AllocW:r.AllocW.clone(),AllocE:r.AllocE.clone(),x:r.x,y:r.y,yesTextSize:r.yesTextSize,noTextSize:r.noTextSize})},this.merge=function(e){var t,a;if(Object.is(r,e))throw"cannot merge same flowchart";e.shapes.children.forEach(function(t){t.trans(e.shapes.x,0),r.shapes.add(t)}),(t=r.loop.breaks).push.apply(t,e.loop.breaks),(a=r.loop.continues).push.apply(a,e.loop.continues),e.y>r.y&&r.moveAbs(e.y)},this.withLoop=function(e,t){var a=r,n=a.loop,i=a.AllocW,o=a.AllocE;r.loop=new ga(e);var s=new ea(da()),c=o.cloneDeep(),h=s.clone(),l=c.clone();r.AllocW=s,r.AllocE=c,t();var p=r.loop;return r.loop=n,r.AllocW=i,r.AllocE=o,r.AllocW.mergeAllocator(h),r.AllocW.mergeAllocator(l),p},this.h=function(e,t){void 0===t&&(t=""),r.shapes.add(z.hline({x:0,y:e,step:100})),""!==t&&r.shapes.add(new ba({content:t,x:0,y:e,w:0,h:0}))},this.type="flowchart",this.shapes=a,this.measureText=n,this.config=i,this.loop=o,this.AllocW=s,this.AllocE=c,this.alive=!0,this.dy=i.flowchart.stepY,this.dx=i.flowchart.stepX,this.hlineMargin=i.flowchart.hlineMargin,this.x=h,this.y=l,this.yesTextSize=p,this.noTextSize=$}}(),sa=function(e){var t=e.node,r=e.config,a=e.measureText,n=new ra({shapes:new ca({x:0,y:0,children:[]}),measureText:a,config:r,loop:new ga,AllocW:new ea(da()),AllocE:new ea(da()),x:0,y:r.flowchart.marginY,yesTextSize:a(r.label.yesText,r.label.attrs),noTextSize:a(r.label.noText,r.label.attrs)});return K(t,n),n.shiftX(-n.shapes.minX+r.flowchart.marginX),n},K=function(e,t,r){void 0===r&&(r=!1);for(var a=t.step,n=t.stepAbs,i=t.stepText,o=t.AllocW,s=t.AllocE,c=t.loop,h=t.hlineMargin,l=e.children,p=l.length,$=0;$<p&&t.alive;){var u=l[$];switch(u.type){case"text":i(u.content);break;case"pass":a();break;case"if":var w=[];for($<p&&"if"===l[$].type&&(w.push(l[$]),$++);$<p&&"elif"===l[$].type;)w.push(l[$]),$++;$<p&&"else"===l[$].type&&(w.push(l[$]),$++),ta(w,t);continue;case"while":Fa(u,t);break;case"do":Ga(u,l[$+1],t),$+=2;continue;case"break":case"continue":if("none"===c.type)throw"loop type must not be none here.";var f=fa[c.type][u.type],x=void 0;if(r)x=t.y-h;else if("W"===f)for(var y=(x=t.y)-99999;x!==y;)y=x,x=o.findSpace(x,h),x=s.findSpace(x,h);else x=s.findSpace(t.y,h);o.merge(x,h),"E"===f&&s.merge(x,h),r||n(x+h);var v=c.breaks,m=c.continues;("break"===u.type?v:m).push(new R({x:0,y:t.y})),t.alive=!1;break;case"try":var d=u,T=[];for($++;$<p&&"except"===l[$].type;)T.push(l[$]),$++;Ha(d,T,t);continue;case"switch":var D=u,g=D.children;Ia(D,g,t);break;case"program":case"none":case"else":case"elif":case"for":case"case":case"except":throw"child type "+u.type+" is not expected. this may be bug...";default:throw"child type "+u.type+" is invalid.";}$++}},ta=function(e,t,r){if(void 0===r&&(r=!1),0!==e.length)if("else"!==e[0].type){var a,n=t.dx,i=t.dy,o=t.hlineMargin,s=t.branch(),c=t.branch(),h=t.loop.type,l=e[0],p={dir:"S",jump:!1},$={dir:"E",jump:!1};if(l.children.length>0)if("break"===(a=l.children[0].type)||"continue"===a){if("none"===h)throw"loop type must not be none here.";p={dir:fa[h][a],jump:!0},$={dir:"S",jump:!1}}if(e.length>1&&"else"===e[1].type&&e[1].children.length>0)if("break"===(a=e[1].children[0].type)||"continue"===a){if("none"===h)throw"loop type must not be none here.";var u=fa[h][a];u!==p.dir&&($={dir:u,jump:!0})}var w=t.stepCond({content:l.content,yesDir:p.dir,noDir:$.dir,jumpW:p.jump&&"W"===p.dir||$.jump&&"W"===$.dir,jumpE:p.jump&&"E"===p.dir||$.jump&&"E"===$.dir,stepY:"if"===e[0].type?i:o});if(s.moveAbs(w[p.dir].y),K(l,s,p.jump),s.shiftX(w[p.dir].x),c.moveAbs(w[$.dir].y),ta(e.slice(1),c,$.jump),$.jump||p.jump)c.shiftX(w[$.dir].x);else{var f=Math.max(w.E.x,s.shapes.maxX)+n-c.shapes.minX;c.shiftX(f),s.shapes.add(z.hline({x:w.E.x,y:w.E.y,step:c.shapes.x-w.E.x}));var x=void 0;if(c.alive){var y=t.AllocE.findSpace(Math.max(s.y,c.y),o);t.AllocW.merge(y,o),x=y+o}else x=Math.max(s.y,c.y);s.alive&&s.stepAbs(x),c.alive&&c.stepAbs(x),c.alive&&s.shapes.add(z.hline({x:c.shapes.x,y:x,step:-c.shapes.x+s.shapes.x,isArrow:s.alive}))}t.merge(s),t.merge(c),s.alive||c.alive||(t.alive=!1)}else K(e[0],t,r)},Fa=function(e,t){var r=t.branch(),a=r.moveAbs,n=r.stepAbs,i=r.dx,o=r.dy,s=r.stepCond,c=r.withLoop,h=r.shapes,l=r.AllocW,p=r.AllocE,$=r.hlineMargin,u=p.findSpace(r.y+o-$,$);l.merge(u,$),n(u+$);var w=r.y,f=s({content:e.content,yesDir:"S",noDir:"E",jumpE:!1,jumpW:!1,stepY:$}),x=c("while",function(){K(e,r)}),y=x.breaks,v=x.continues,m=N(v),d=N(y);if(r.alive){u=p.findSpace(r.y,$);l.merge(u,$),n(u+$),m.push(new R({x:0,y:r.y}))}d.push(new R(qa({},f.E)));var T=Math.min(f.W.x,h.minX)-i,D=Math.max(f.E.x,h.maxX)+i;m.sort(function(e,t){return e.y>t.y?-1:1}).forEach(function(e,t){h.add(new z({x:e.x,y:e.y,isArrow:!0,cmds:0===t?[["h",T-e.x],["v",w-e.y],["h",-T]]:[["h",T-e.x]]}))});u=p.findSpace(r.y,$);l.merge(u,$),a(u+$),d.sort(function(e,t){return e.y<t.y?-1:1}).forEach(function(e,t){h.add(new z({x:e.x,y:e.y,isArrow:0!==t,cmds:0===t?[["h",D-e.x],["v",r.y-e.y],["h",-D]]:[["h",D-e.x]]}))}),t.merge(r)},Ga=function(e,t,r){var a=r.branch(),n=a.moveAbs,i=a.stepAbs,o=a.dx,s=a.dy,c=a.shapes,h=a.withLoop,l=a.AllocW,p=a.AllocE,$=a.hlineMargin,u=p.findSpace(a.y+s-$,$);l.merge(u,$),i(u+$);var w,f,x=a.y,y=h("doWhile",function(){K(e,a)}),v=y.breaks,m=y.continues,d=N(v),T=0;if(a.alive||m.length>0){if(m.length>0){u=p.findSpace(a.y,$);l.merge(u,$),a.alive?i(u+$):n(u+$),T=c.maxX+o,m.sort(function(e,t){return e.y<t.y?-1:1}).forEach(function(e,t){c.add(new z({x:e.x,y:e.y,isArrow:0!==t||a.alive,cmds:0===t?[["h",T-e.x],["v",a.y-e.y],["h",-T]]:[["h",T-e.x]]}))})}var D=a.branch(),g=D.stepCond({content:t.content,yesDir:"S",noDir:"E",jumpW:!1,jumpE:!1}),A=D.shapes.maxX,b=D.shapes.minX;a.merge(D);u=p.findSpace(a.y,$);l.merge(u,$),i(u+$),w=Math.min(b,c.minX)-o,c.add(new z({x:0,y:a.y,isArrow:!0,cmds:[["h",w],["v",x-a.y],["h",-w]]})),f=v.length>0?Math.max(A,c.maxX,T)+o:A+o,d.push(new R(qa({},g.E)))}else{u=p.findSpace(a.y,$);l.merge(u,$),n(u+$),f=c.maxX+o}u=p.findSpace(a.y,$);l.merge(u,$),n(u+$),d.sort(function(e,t){return e.y<t.y?-1:1}).forEach(function(e,t){c.add(new z({x:e.x,y:e.y,isArrow:0!==t,cmds:0===t?[["h",f-e.x],["v",a.y-e.y],["h",-f]]:[["h",f-e.x]]}))}),r.merge(a)},Ha=function(e,t,r){var a,n,i=r.dx,o=r.hlineMargin,s=r.branch(),c=t.map(function(){return r.branch()}),h=s.branch(),l=h.AllocE.findSpace(h.y,o);h.AllocW.merge(l,o);var p=l+o;h.stepAbs(p),K(e,h);var $=s.AllocE.findSpace(p,o);s.AllocW.merge($,o),n=$+o;var u=s.AllocE.findSpace(Math.max(h.y,n),o);s.AllocW.merge(u,o);var w=u+o;h.alive?h.stepAbs(w):h.moveAbs(w),a=h.x+h.shapes.maxX+i;var f=h.x+h.shapes.minX-i;h.shapes.add(new oa({x:f,y:p,w:a-f,h:w-p})),s.merge(h),h.alive||(s.alive=!1),c.forEach(function(e){e.moveAbs(n)});var x=s;if(t.forEach(function(e,t){var r=c[t],a=r.y;K(e,r);var n=x.x+x.shapes.maxX+i-r.shapes.minX;r.shiftX(n),r.shapes.add(r.textWithAutoSize({x:r.config.label.marginX,y:a+r.config.label.marginY,text:e.content,isLabel:!0})),x=r}),s.shapes.add(z.hline({x:a,y:n,step:c.slice(-1)[0].shapes.x-a})),c.some(function(e){return e.alive})){var y=N([s],c).map(function(e){return e.y}).reduce(function(e,t){return Math.max(e,t)}),v=r.AllocE.findSpace(y,o);r.AllocW.merge(v,o);var m=v+o;N([s],c).filter(function(e){return e.alive}).forEach(function(e){e.stepAbs(m)});var d=c.filter(function(e){return e.alive}).slice(-1)[0];s.shapes.add(z.hline({x:d.shapes.x,y:m,step:-d.shapes.x+s.shapes.x,isArrow:s.alive}))}else if(s.alive){var T=N([s],c).map(function(e){return e.y}).reduce(function(e,t){return Math.max(e,t)});s.stepAbs(T)}r.merge(s),c.forEach(function(e){return r.merge(e)}),N([s],c).every(function(e){return!e.alive})&&(r.alive=!1)},Ia=function(e,t,r){var a=r.dx,n=r.hlineMargin,i=r.branch(),o=t.map(function(){return r.branch()}),s=i.diamond({x:0,y:0,text:e.content}),c=i.AllocE.findSpace(r.y,n+s.h+n);i.AllocW.merge(c,n+s.h+n);var h=c+n;i.stepAbs(h,!0),i.move(s.h),s.trans(0,h),i.shapes.add(s),i.step(n);var l=i.y;o.forEach(function(e){e.moveAbs(l)});var p=0;t.forEach(function(e,t){var r=o[t],n=r.y;K(e,r);var i=0===t?0:p+a-r.shapes.minX;r.shiftX(i),r.shapes.add(r.textWithAutoSize({x:r.config.label.marginX,y:n+r.config.label.marginY,text:e.content,isLabel:!0})),p=r.x+r.shapes.maxX}),i.shapes.add(z.hline({x:0,y:l,step:o.slice(-1)[0].shapes.x}));var $=o.map(function(e){return e.alive?1:0}).reduce(function(e,t){return e+t}),u=o.map(function(e){return e.y}).reduce(function(e,t){return Math.max(e,t)});if($>0&&(!o[0].alive||1!==$)){var w=r.AllocE.findSpace(u,n);r.AllocW.merge(w,n);var f=w+n;o.filter(function(e){return e.alive}).forEach(function(e){e.stepAbs(f)});var x=o.filter(function(e){return e.alive}).slice(-1)[0];i.shapes.add(z.hline({x:x.shapes.x,y:f,step:-x.shapes.x+i.shapes.x,isArrow:o[0].alive}))}var y=o.map(function(e){return e.y}).reduce(function(e,t){return Math.max(e,t)});o.forEach(function(e){e.alive?e.stepAbs(y):e.moveAbs(y)}),r.merge(i),o.forEach(function(e){r.merge(e)}),0===$&&(r.alive=!1)};O.Flowchart=ra,O.createFlowchart=sa;var Y={},k=Y&&Y.__assign||function(){return(k=Object.assign||function(a){for(var $,r=1,t=arguments.length;r<t;r++)for(var s in $=arguments[r])Object.prototype.hasOwnProperty.call($,s)&&(a[s]=$[s]);return a}).apply(this,arguments)},G="black",ua={src:{indentStr:"  ",commentStr:"#"},flowchart:{marginX:35,marginY:35,stepX:24,stepY:24,hlineMargin:24,backgroundColor:"white"},rect:{padX:12,padY:8,attrs:{stroke:G,fill:"none","stroke-width":"2px"}},frame:{attrs:{stroke:G,fill:"none","stroke-dasharray":"2","stroke-width":"2px"}},diamond:{aspectRatio:.75,attrs:{stroke:G,fill:"none","stroke-width":"2px"}},path:{attrs:{stroke:G,fill:"none","stroke-linecap":"square","stroke-width":"2px"}},arrowHead:{size:9,attrs:{stroke:G,fill:G,"stroke-width":"0px"}},text:{attrs:{stroke:G,fill:G,"font-size":"14px","stroke-width":"0"}},label:{yesText:"Y",noText:"N",marginX:4,marginY:4,attrs:{stroke:G,fill:G,"font-size":"10px","font-weight":"lighter"}}},va=function(a,$){return void 0===$&&($={}),{src:k(k({},a.src),$.src||{}),flowchart:k(k({},a.flowchart),$.flowchart||{}),rect:k(k(k({},a.rect),$.rect||{}),{attrs:k(k({},a.rect.attrs),$.rect&&$.rect.attrs||{})}),diamond:k(k(k({},a.diamond),$.diamond||{}),{attrs:k(k({},a.diamond.attrs),$.diamond&&$.diamond.attrs||{})}),path:k(k(k({},a.path),$.path||{}),{attrs:k(k({},a.path.attrs),$.path&&$.path.attrs||{})}),arrowHead:k(k(k({},a.arrowHead),$.arrowHead||{}),{attrs:k(k({},a.arrowHead.attrs),$.arrowHead&&$.arrowHead.attrs||{})}),text:k(k(k({},a.text),$.text||{}),{attrs:k(k({},a.text.attrs),$.text&&$.text.attrs||{})}),frame:k(k(k({},a.frame),$.frame||{}),{attrs:k(k({},a.frame.attrs),$.frame&&$.frame.attrs||{})}),label:k(k(k({},a.label),$.label||{}),{attrs:k(k({},a.label.attrs),$.label&&$.label.attrs||{})})}},wa=function(a){return void 0===a&&(a={}),va(ua,a)};Y.mergeDefaultConfig=wa,Y.mergeConfig=va,Y.defaultConfig=ua;var H=aa&&aa.__assign||function(){return(H=Object.assign||function(e){for(var r,a=1,t=arguments.length;a<t;a++)for(var n in r=arguments[a])Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);return e}).apply(this,arguments)},Ja=!1,ha=function(){return function(e){var r=this,a=e.src,t=e.config,n=e.document;this.el=function(e,a){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var s=r._document.createElementNS("http://www.w3.org/2000/svg",e);return Object.entries(a||{}).forEach(function(e){var r=e[0],a=e[1];return s.setAttribute("className"===r?"class":r,a.toString())}),(t||[]).forEach(function(e){return s.append(e)}),s},this.createTextSVGElement=function(e,a){var t=r.el,n=t("text",a||{});return e.split(/\\n/).forEach(function(e,r){n.append(t("tspan",{x:a.x,dy:(0===r?0:1)+"em"},e))}),n},this.measureText=function(e,a){void 0===a&&(a={});var t=r,n=t.dummySVG,s=t.createTextSVGElement,i=H(H({},a),{x:a.x||0});r._document.body.append(n);var o=s(e,i);n.append(o);var h=o.getBoundingClientRect(),p=h.width,d=h.height;return n.removeChild(o),r._document.body.removeChild(n),{w:p,h:d}},this.renderShape=function(e){var a=e.layers,t=e.shape,n=e.offsetX,s=void 0===n?0:n,i=e.offsetY,o=void 0===i?0:i,h=s+t.x,p=o+t.y;switch(t.type){case"group":t.children.forEach(function(e){return r.renderShape({layers:a,shape:e,offsetX:h,offsetY:p})});break;case"text":a.textLayer.append(r.renderText({x:h,y:p,shape:t}));break;case"path":a.pathLayer.append(r.renderPath({x:h,y:p,shape:t}));break;case"rect":a.nodeLayer.append(r.renderRect({x:h,y:p,shape:t}));break;case"frame":a.frameLayer.append(r.renderFrame({x:h,y:p,shape:t}));break;case"diamond":a.nodeLayer.append(r.renderDiamond({x:h,y:p,shape:t}));break;case"point":break;default:throw"shape "+t+" is invalid";}},this.renderText=function(e){var a=e.x,t=e.y,n=e.shape,s=r.config;return r.createTextSVGElement(n.content,H({x:a,y:t+(n.isLabel?r.labelHeight:r.textHeight)/2,"dominant-baseline":"central"},n.isLabel?s.label.attrs:s.text.attrs))},this.renderRect=function(e){var a=e.x,t=e.y,n=e.shape,s=r.config,i=n.w,o=n.h;return r.el("rect",H({x:a,y:t,width:i,height:o},s.rect.attrs))},this.renderFrame=function(e){var a=e.x,t=e.y,n=e.shape,s=r.config,i=n.w,o=n.h;return r.el("rect",H({x:a,y:t,width:i,height:o},s.frame.attrs))},this.renderDiamond=function(e){var a=e.x,t=e.y,n=e.shape,s=r.config,i=n.w,o=n.h;return r.el("polygon",H({points:a+i/2+","+t+", "+(a+i)+","+(t+o/2)+" "+(a+i/2)+","+(t+o)+" "+a+","+(t+o/2)},s.diamond.attrs))},this.renderPath=function(e){var a=e.x,t=e.y,n=e.shape,s=r.config,i="M "+a+" "+t,o=n.cmds.map(function(e){return e.join(" ")}).join(" ");return r.el("path",H(H({d:i+" "+o},n.isArrow?{"marker-end":"url(#arrow-head)"}:{}),s.path.attrs))},this.render=function(){var e=r,a=e.src,t=e.config,n=e.el,s=e.measureText,i=e.renderShape,o=r.svg,h=n("defs",null,n("marker",{id:"arrow-head",markerUnits:"userSpaceOnUse",markerWidth:""+t.arrowHead.size,markerHeight:""+2*t.arrowHead.size,viewBox:"0 0 10 10",refX:"10",refY:"5",orient:"auto-start-reverse"},n("polygon",H({points:"0,0 0,10 10,5",class:"arrow-head"},t.arrowHead.attrs))));o.append(h);var p=n("g"),d=n("g"),c=n("g"),$=n("g"),u=n("g"),l=sa({node:ma(a,t),config:t,measureText:s});i({layers:{frameLayer:d,pathLayer:c,nodeLayer:$,textLayer:u},shape:l.shapes}),o.append(p),o.append(d),o.append(c),o.append($),o.append(u);var f=l.shapes.w+2*t.flowchart.marginX,g=l.shapes.h+2*t.flowchart.marginY;o.setAttribute("width",String(f)),o.setAttribute("height",String(g)),o.setAttribute("viewBox","0 0 "+f+" "+g);var v=t.flowchart.backgroundColor;return["","none","transparent"].includes(v)||p.append(n("rect",{x:0,y:0,width:f,height:g,fill:v})),o},this._document=n,this.src=a,this.config=t=wa(t),this.dummySVG=this.el("svg"),this.svg=this.el("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg"}),this.labelHeight=this.measureText("A",t.label.attrs).h,this.textHeight=this.measureText("A",t.text.attrs).h}}(),xa=function(e){if(Ja){var r=performance.now(),a=new ha(e).render(),t=performance.now();return console.log("rendering: "+(t-r)+" ms"),a}return new ha(e).render()};aa.Renderer=ha,aa.render=xa;var Ka=Z&&Z.__spreadArrays||function(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;var a=Array(r),c=0;for(e=0;e<t;e++)for(var n=arguments[e],$=0,f=n.length;$<f;$++,c++)a[c]=n[$];return a},La={initialize:function(r){Ka(document.getElementsByClassName("tefcha")).forEach(function(e){var t=e.textContent;e.textContent="",e.append(xa({src:t,document:document,config:r}))})}};window.tefcha=La;if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=Z}else if(typeof define==="function"&&define.amd){define(function(){return Z})}})();